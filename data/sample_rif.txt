.define fade-in
	.to {"opacity": 0.0}
	.to {"opacity": 1.0}
.enddef

.define expand-and-fade-in
	.to {"font-size": "0%", "opacity": "0"}
	.to {"font-size": "100%"} .lasting 1000
	.to {"opacity": "1"} .lasting 1000
.enddef

.define fades-out-intro
	.animates #introfadefirst .to { "opacity": 0.2 } .lasting 3000 .to { "opacity": 0 } .lasting 15000
	.animates #introdream .to { "opacity": 1 } .lasting 2000 .to { "opacity": 0.2 } .lasting 4000 .to { "opacity": 0 } .lasting 30000
	.animates #introdream2 .to { "opacity": 1 } .lasting 2000 .to { "opacity": 0.2 } .lasting 4000 .to { "opacity": 0 } .lasting 20000
.enddef

.define hides-bar
	.animates #bar .to { "opacity": 0 }
.enddef
.define shows-bar
	.animates #bar .to { "opacity": 1 } .lasting 2000
.enddef

.define populates-icons
			.says <div class="baricon">{!<img src="image/look.png">|LOOK!}</div>
					<div class="baricon">{!<img src="image/move.png">|MOVE!}</div>
					<div class="baricon">{!<img src="image/use.png">|USE!}</div>
					<div class="baricon" style="margin-left:8px">{!<img src="image/talk.png">|TALK!}</div>
				.into #commandPane
.enddef

.set break=<span style='font-size:6pt;'>&nbsp;</span>
.move player .to alcove

.responses alcove
	.response
		.matches LOOK
		.runs 1
		.does
			.hides-bar
			.says
				<div id="intro">
					<div id="introfadefirst">
						<div id="introrain"></div>
						<div id="introwind"></div>
					</div>
					<div id="introdream">{!You dream.|INTRODREAM!}<div id="introdream1"></div></div><div id="introdream2"></div>
				</div>
			.animates #intro .fade-in .lasting 1000
	.response
		.matches INTRODREAM
		.runs 2
		.does 1
				.says {!The patter of rain|INTRORAIN!}<div id="rainpunc">.</div> <div id="introrain2"></div> .into #introrain
				.says {!A caress of wind|INTROWIND!}<div id="windpunc">.</div> <div id="introwind2"></div> .into #introwind
				.says {!..|INTRODREAM!} .into #introdream1
				.animates #introrain, #introwind, #introdream1 .expand-and-fade-in
		.does 2 .says but you should not dream. .into #introdream2
				.animates #introdream2 .fade-in .lasting 1000
				.animates #introdream .to { "opacity": 1 } .lasting 1000
				.sets intro_saw_dream
				.calls INTRODONE

	.response
		.matches INTRORAIN 
		.runs 1
		.does
			.says , .into #rainpunc
			.says but there is no rain. .into #introrain2
			.animates #introrain2 .expand-and-fade-in
			.sets intro_saw_rain
			.invokes
				$("#introrain span").css("cursor", "inherit")
			.calls INTRODONE
	.response
		.matches INTROWIND
		.runs 1 
		.does
			.says , .into #windpunc
			.says but there is no wind. .into #introwind2
			.animates #introwind2 .expand-and-fade-in
			.sets intro_saw_wind
			.calls INTRODONE
		
	.response
		.matches INTRODONE
		.needs intro_saw_dream intro_saw_rain intro_saw_wind
		.does
			.says
				{=break=}
				<div id="wakeup">{!An incoming message wakens you.|message!} {!The conversations of the Others are muted and overlapping, but there's an unmistakable undercurrent of irritation.|theothers!}</div>
			.fades-out-intro
			.populates-icons
			.shows-bar
			.animates #wakeup .fade-in .lasting 3000

	.response
		.matches message
		.does
			.says
				The message is terse and to the point:<br>
				<span style="font-family:'Courier New'; font-size:12pt;">Directive, status immediate<br>
				F47C communication disconnect. {!EAR!}.</span>
	
	.response
		.matches theothers
		.does
			.says 
		
	.response .matches EAR .does .says "Evaluate and repair." 
	.response
		.matches LOOK
		.does 1
		.does .says Look! .autohides
	.response
		.matches MOVE
		.does
			.uses first
				.response
					.needs door-open
					.does .says The door is open, but you can't move.
				.response
					.does .says {!The door to your alcove is closed|door!}.
			.end
	.response
		.matches door
		.needs !door-open
		.prompts Open the alcove door
		.forcesprompt
		.does
			.sets door-open
			.says The alcove door slides open.
	.response
		.matches door
		.needs door-open
		.prompts Close the alcove door
		.forcesprompt
		.does
			.sets !door-open
			.says The alcove door slides shut.
	.response
		.matches USE
		.does .says Use! .autohides
	.response
		.matches TALK
		.does .says Talk! .autohides
.end
