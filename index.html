<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Meek</title>
    <link rel="stylesheet" href="style.css" type="text/css">
    <script type="text/javascript" src="lib/jquery-1.11.0.js"></script>
    <script src="//code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
    <script type="text/javascript" src="src/HTMLFormatter.js"></script>
    <script type="text/javascript" src="src/Interact.js"></script>
    <script type="text/javascript" src="src/response_lib.js"></script>
    <script type="text/javascript" src="src/rif_dom.js"></script>
    <script type="text/javascript" src="src/rif_expand.js"></script>
    <script type="text/javascript" src="src/rif_parse.js"></script>
    <script type="text/javascript" src="src/rif_tokenize.js"></script>

    <script type="text/javascript">
        function init() {
            var rifSource = $.ajax({
                url: "data/sample_rif.txt",
                async: false
            }).responseText;

            var tokens = rifTokenize(rifSource);
            tokens = rifExpand(tokens);
            var rif  = rifParse(tokens);

            var world = {
                states: {},
                getState: function(id) {
                    return states[id];
                },
                setState: function(id, value) {
                    states[id] = value;
                }
            };

            var dom = new RifDOM($('#output'));
            var formatter = new HTMLFormatter();
            var clickFactory = function(keyword) {
                return function (e) {
                    var target = $(e.target);
                    var original_color = target.css("color");
                    target.animate({color: "#c0c000"},250).animate({color: original_color}, 300);
                    world.sendCommand(keyword);
                };
            };
            var interact = new Interact(dom, formatter, clickFactory, world);

            interact.setState("break=<span style='font-size:6pt;'>&nbsp;</span>");

            var response_lib = new ResponseLib(interact);
            world.sendCommand = function(keyword) {
                this.callTopics([keyword]);
                interact.say({text: "{break}"});
            };
            world.callTopics = function(topics) {
                response_lib.callTopics({general: rif.responses.room}, topics, "me");
            };
            world.sendCommand("LOOK");
        }
    </script>
</head>
<body onLoad="init()">
    <div id="holder">
        <div id="spacer"></div>
        <div id="output"></div>
    </div>
</body>
</html>
