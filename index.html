<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Meek</title>
    <link rel="stylesheet" href="style.css" type="text/css">
    <script type="text/javascript" src="lib/jquery-1.11.0.js"></script>
    <script src="http://code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
    <script type="text/javascript" src="src/HTMLFormatter.js"></script>
    <script type="text/javascript" src="src/rif_interact.js"></script>
    <script type="text/javascript" src="src/response_lib.js"></script>
    <script type="text/javascript" src="src/rif_dom.js"></script>
    <script type="text/javascript" src="src/rif_expand.js"></script>
    <script type="text/javascript" src="src/rif_parse.js"></script>
    <script type="text/javascript" src="src/rif_tokenize.js"></script>
    <script type="text/javascript" src="src/rif_world.js"></script>
    <script type="text/javascript" src="src/rif_load.js"></script>

    <script type="text/javascript">
        function loadFile(name, completion) {
            $.ajax({
                url: "data/" + name
            }).done(completion);
        }
        function loadRif(file, world, completion) {
            var load = new rifLoad(loadFile);
            load.loadTokens(file, function (tokens) {
                rifExpand(tokens, function(tokens) {
                    var rif = rifParse(tokens);
                    world.addRif(rif);
                    completion(rif);
                });
            });
        }
        function createInteract(world, rif) {
            var dom = new RifDOM($('#output'));
            var formatter = new HTMLFormatter();
            var response_lib = new ResponseLib(world);
            return new RifInteract(dom, formatter, world, response_lib, rif);
        }
        function init() {
            var world = new RifWorld();

            loadRif("sample_rif.txt", world, function(rif) {
                var interact = createInteract(world, rif);
                //console.info("rif=", rif)

                interact.sendCommand(["START"]);
            });
        }
    </script>
</head>
<body onLoad="init()">
    <div id="holder">
        <div id="spacer"></div>
        <div id="output"></div>
        <div id="barspacer"></div>
        <div id="footer">
            <div id="bar">
                <div id="barLeftHolder"><span id="commandPane"></span></div>
                <div id="barRightHolder"><span id="helpPane"></span></div>
            </div>
            <div style="font-size:12pt;"><br></div>
        </div>
    </div>
</body>
</html>
